---
title: "Final Project "
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(leaflet)
library(DT)
library(plotly)
library(flexdashboard)
ufo_sightings <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-06-25/ufo_sightings.csv")
#exercise 1----
##data manipulation
ufo_sightings_us <- ufo_sightings %>% 
  filter(country == "us") %>% 
  mutate(date_time = mdy_hm(date_time),
         date_documented = mdy(date_documented))
##parameterized Rmd (see params.Rmd)
#exercise 2----
##leaflet for `encounter_length`
pal <- colorQuantile("YlOrRd", NULL, n = 8)
leaflet(ufo_sightings) %>% 
  addTiles() %>%
  addCircleMarkers(color = ~pal(encounter_length))
##plotly for `shape`
#filter to 3 shapes
ufo_sightings_shapes <- ufo_sightings %>% 
  filter(ufo_shape %in% c("circle", "fireball", "oval"))
#plot
p <- ggplot(data = ufo_sightings_shapes, aes(x = ufo_shape)) +
  geom_bar(position = "dodge")
ggplotly(p)
#DT
datatable(ufo_sightings_us, options = list(pageLength = 5))
ufo_sightings_co <- ufo_sightings %>% 
  mutate(date_time = mdy_hm(date_time),
         sighting_year = year(date_time)) %>% 
  filter(state == 'co')
```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r}
pal <- colorQuantile("YlOrRd", NULL, n = 8)
leaflet() %>% 
  addTiles() %>% 
  fitBounds(-102.03,37,-109.03, 41) %>% 
  addTiles() %>% 
  addCircleMarkers(ufo_sightings_co$longitude, 
                   ufo_sightings_co$latitude, 
                   color = ufo_sightings_co$encounter_length, 
                   radius = 5, 
                   fill = T,
                   fillOpacity = 0.2,
                   opacity = 0.6,
                   popup = paste(ufo_sightings_co$city_area,
                                 ufo_sightings_co$sighting_year, 
                                 sep = ",")) 
```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}
ufo_sightings_co <-  ufo_sightings_co %>%
  group_by(sighting_year) %>%
  summarize(n_year = n()) %>%
  ungroup()
ggplot(ufo_sightings_co, aes(x = sighting_year, y = n_year)) +
  geom_line() +
  ggthemes::theme_few() +
  labs(x = "Year", y = "Sighting Count in CO", title = "UFO Sightings in CO per Year")
```

### Chart C

```{r}
ufo_sightings_co <-  ufo_sightings_co %>%
  group_by(sighting_year) %>%
  summarize(n_year = n()) %>%
  ungroup()
ufo_sightings_co %>%
datatable()
```
