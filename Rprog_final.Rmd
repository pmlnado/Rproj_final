---
title: "Final Project"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(leaflet)
library(DT)
library(plotly)
library(flexdashboard)
library(sf)
library(tigris)

#try fuzzyjoint package

#Goal: to assess the diversity ratio among students across all the Higher Education institutions in Colorado

#plan: pivot data wider -> join datasets -> convert into sf object -> good to map

## data manipulation
# read data and filter just for Colorado

diversity_school <- read.csv("diversity_school.csv")

co_schools_data <- diversity_school %>% 
  filter(state == "Colorado") 

#Count amount of schools in Colorado
co_schools_data %>% 
  select(name) %>%
  distinct() %>%
  count()

#top ten universities in CO - all data.
#top10_co_schools_data <- co_schools_data %>%
  #head(n= 10)

#pivot wider so that each ethnic group has it's own column, and there is only one University name in the names column
co_schools_data <- pivot_wider(co_schools_data,
            names_from = "category",
            values_from = enrollment)

#top ten universities in CO (based on enrollment)
top10_co_schools_enrollment <- co_schools_data %>%
  distinct() %>%
  head(n= 10)


#coordinates for the top 10 schools in Colorado
top10_co_schools_coordinates <- read.csv("co_top10uni_coordinates.csv")

top10_co_schools_coordinates

#change school name column name to match in both datasets

top10_co_schools_coordinates
top10_co_schools_enrollment

top10_co_schools_enrollment <- top10_co_schools_enrollment %>%
  rename(school = name)
#ok, now both have school names listed in column "school". Now join.


#merge data sets
top10CoData <- inner_join(top10_co_schools_coordinates, top10_co_schools_enrollment)

top10CoData


##########
#convert to dataset an sf object 
#top10CoData = st_as_sf(top10CoData, coords = c("longitude", "latitude")) %>%
  #st_set_crs(4269)

#pull geophraphical data from tigris to map the diversity data. convert to an sf object.

#co_counties <- counties(state = "CO", class = "sf")
#class(co_counties)
#############
#OK, I am going to try to plot the distribution of ethnics groups across the top 10 largest CO campuses and have that plot pop up in my interactive map using the popuo function.


```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r}

pal <- colorQuantile("YlOrRd", NULL, n = 8)
top10CoData

#Make the data an sf object 
class(top10CoData)

top10CoData_sf <- st_as_sf(top10CoData, coords = c("longitude", "latitude"))
                                              
top10CoData_sf

class(top10CoData_sf)

##

leaflet() %>% 
  addTiles() %>% 
  fitBounds(-102.03,37,-109.03, 41) %>% 
  addTiles() %>% 
  addCircleMarkers(top10CoData$total_enrollment, lon = "top10CoData$
                    longitude", lat = "top10CoData$latitude",
                   color = top10CoData$total_enrollment, 
                   radius = 5, 
                   fill = T,
                   fillOpacity = 0.2,
                   opacity = 0.6,
                   popup = paste(top10CoData$Black,
                                 top10CoData$White, 
                                 sep = ",")) 
```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}
ufo_sightings_co <-  ufo_sightings_co %>%
  group_by(sighting_year) %>%
  summarize(n_year = n()) %>%
  ungroup()
ggplot(ufo_sightings_co, aes(x = sighting_year, y = n_year)) +
  geom_line() +
  ggthemes::theme_few() +
  labs(x = "Year", y = "Sighting Count in CO", title = "UFO Sightings in CO per Year")
```

### Chart C

```{r}
ufo_sightings_co <-  ufo_sightings_co %>%
  group_by(sighting_year) %>%
  summarize(n_year = n()) %>%
  ungroup()
ufo_sightings_co %>%
datatable()
```
